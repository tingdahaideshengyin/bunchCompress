(function(e){"use strict";typeof define=="function"&&define.amd?define(["jquery"],e):e(typeof jQuery!="undefined"?jQuery:window.Zepto)})(function(e){"use strict";function t(t){var n=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).ajaxSubmit(n))}function n(t){var n=t.target,r=e(n);if(!r.is("[type=submit],[type=image]")){var i=r.closest("[type=submit]");if(i.length===0)return;n=i[0]}var s=this;s.clk=n;if(n.type=="image")if(t.offsetX!==undefined)s.clk_x=t.offsetX,s.clk_y=t.offsetY;else if(typeof e.fn.offset=="function"){var o=r.offset();s.clk_x=t.pageX-o.left,s.clk_y=t.pageY-o.top}else s.clk_x=t.pageX-n.offsetLeft,s.clk_y=t.pageY-n.offsetTop;setTimeout(function(){s.clk=s.clk_x=s.clk_y=null},100)}function r(){if(!e.fn.ajaxSubmit.debug)return;var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}var i={};i.fileapi=e("<input type='file'/>").get(0).files!==undefined,i.formdata=window.FormData!==undefined;var s=!!e.fn.prop;e.fn.attr2=function(){if(!s)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||typeof e=="string"?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t){function n(n){var r=e.param(n,t.traditional).split("&"),i=r.length,s=[],o,u;for(o=0;o<i;o++)r[o]=r[o].replace(/\+/g," "),u=r[o].split("="),s.push([decodeURIComponent(u[0]),decodeURIComponent(u[1])]);return s}function o(r){var i=new FormData;for(var s=0;s<r.length;s++)i.append(r[s].name,r[s].value);if(t.extraData){var o=n(t.extraData);for(s=0;s<o.length;s++)o[s]&&i.append(o[s][0],o[s][1])}t.data=null;var u=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:a||"POST"});t.uploadProgress&&(u.xhr=function(){var n=e.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(e){var n=0,r=e.loaded||e.position,i=e.total;e.lengthComputable&&(n=Math.ceil(r/i*100)),t.uploadProgress(e,r,i,n)},!1),n}),u.data=null;var f=u.beforeSend;return u.beforeSend=function(e,n){t.formData?n.data=t.formData:n.data=i,f&&f.call(this,e,n)},e.ajax(u)}function u(n){function i(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(n){r("cannot get iframe.contentWindow document: "+n)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(n){r("cannot get iframe.contentDocument: "+n),t=e.document}return t}function o(){function t(){try{var e=i(y).readyState;r("state = "+e),e&&e.toLowerCase()=="uninitialized"&&setTimeout(t,50)}catch(n){r("Server abort: ",n," (",n.name,")"),u(C),x&&clearTimeout(x),x=undefined}}var n=c.attr2("target"),s=c.attr2("action"),o="multipart/form-data",l=c.attr("enctype")||c.attr("encoding")||o;f.setAttribute("target",m),(!a||/post/i.test(a))&&f.setAttribute("method","POST"),s!=p.url&&f.setAttribute("action",p.url),!p.skipEncodingOverride&&(!a||/post/i.test(a))&&c.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),p.timeout&&(x=setTimeout(function(){S=!0,u(N)},p.timeout));var h=[];try{if(p.extraData)for(var d in p.extraData)p.extraData.hasOwnProperty(d)&&(e.isPlainObject(p.extraData[d])&&p.extraData[d].hasOwnProperty("name")&&p.extraData[d].hasOwnProperty("value")?h.push(e('<input type="hidden" name="'+p.extraData[d].name+'">').val(p.extraData[d].value).appendTo(f)[0]):h.push(e('<input type="hidden" name="'+d+'">').val(p.extraData[d]).appendTo(f)[0]));p.iframeTarget||g.appendTo("body"),y.attachEvent?y.attachEvent("onload",u):y.addEventListener("load",u,!1),setTimeout(t,15);try{f.submit()}catch(v){var b=document.createElement("form").submit;b.apply(f)}}finally{f.setAttribute("action",s),f.setAttribute("enctype",l),n?f.setAttribute("target",n):c.removeAttr("target"),e(h).remove()}}function u(t){if(b.aborted||_)return;O=i(y),O||(r("cannot access response document"),t=C);if(t===N&&b){b.abort("timeout"),T.reject(b,"timeout");return}if(t==C&&b){b.abort("server abort"),T.reject(b,"error","server abort");return}if(!O||O.location.href==p.iframeSrc)if(!S)return;y.detachEvent?y.detachEvent("onload",u):y.removeEventListener("load",u,!1);var n="success",s;try{if(S)throw"timeout";var o=p.dataType=="xml"||O.XMLDocument||e.isXMLDoc(O);r("isXml="+o);if(!o&&window.opera&&(O.body===null||!O.body.innerHTML)&&--M){r("requeing onLoad callback, DOM not available"),setTimeout(u,250);return}var a=O.body?O.body:O.documentElement;b.responseText=a?a.innerHTML:null,b.responseXML=O.XMLDocument?O.XMLDocument:O,o&&(p.dataType="xml"),b.getResponseHeader=function(e){var t={"content-type":p.dataType};return t[e.toLowerCase()]},a&&(b.status=Number(a.getAttribute("status"))||b.status,b.statusText=a.getAttribute("statusText")||b.statusText);var f=(p.dataType||"").toLowerCase(),l=/(json|script|text)/.test(f);if(l||p.textarea){var c=O.getElementsByTagName("textarea")[0];if(c)b.responseText=c.value,b.status=Number(c.getAttribute("status"))||b.status,b.statusText=c.getAttribute("statusText")||b.statusText;else if(l){var h=O.getElementsByTagName("pre")[0],d=O.getElementsByTagName("body")[0];h?b.responseText=h.textContent?h.textContent:h.innerText:d&&(b.responseText=d.textContent?d.textContent:d.innerText)}}else f=="xml"&&!b.responseXML&&b.responseText&&(b.responseXML=D(b.responseText));try{A=H(b,f,p)}catch(m){n="parsererror",b.error=s=m||n}}catch(m){r("error caught: ",m),n="error",b.error=s=m||n}b.aborted&&(r("upload aborted"),n=null),b.status&&(n=b.status>=200&&b.status<300||b.status===304?"success":"error"),n==="success"?(p.success&&p.success.call(p.context,A,"success",b),T.resolve(b.responseText,"success",b),v&&e.event.trigger("ajaxSuccess",[b,p])):n&&(s===undefined&&(s=b.statusText),p.error&&p.error.call(p.context,b,n,s),T.reject(b,"error",s),v&&e.event.trigger("ajaxError",[b,p,s])),v&&e.event.trigger("ajaxComplete",[b,p]),v&&!--e.active&&e.event.trigger("ajaxStop"),p.complete&&p.complete.call(p.context,b,n),_=!0,p.timeout&&clearTimeout(x),setTimeout(function(){p.iframeTarget?g.attr("src",p.iframeSrc):g.remove(),b.responseXML=null},100)}var f=c[0],l,h,p,v,m,g,y,b,w,E,S,x,T=e.Deferred();T.abort=function(e){b.abort(e)};if(n)for(h=0;h<d.length;h++)l=e(d[h]),s?l.prop("disabled",!1):l.removeAttr("disabled");p=e.extend(!0,{},e.ajaxSettings,t),p.context=p.context||p,m="jqFormIO"+(new Date).getTime(),p.iframeTarget?(g=e(p.iframeTarget),E=g.attr2("name"),E?m=E:g.attr2("name",m)):(g=e('<iframe name="'+m+'" src="'+p.iframeSrc+'" />'),g.css({position:"absolute",top:"-1000px",left:"-1000px"})),y=g[0],b={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var n=t==="timeout"?"timeout":"aborted";r("aborting upload... "+n),this.aborted=1;try{y.contentWindow.document.execCommand&&y.contentWindow.document.execCommand("Stop")}catch(i){}g.attr("src",p.iframeSrc),b.error=n,p.error&&p.error.call(p.context,b,n,t),v&&e.event.trigger("ajaxError",[b,p,n]),p.complete&&p.complete.call(p.context,b,n)}},v=p.global,v&&0===e.active++&&e.event.trigger("ajaxStart"),v&&e.event.trigger("ajaxSend",[b,p]);if(p.beforeSend&&p.beforeSend.call(p.context,b,p)===!1)return p.global&&e.active--,T.reject(),T;if(b.aborted)return T.reject(),T;w=f.clk,w&&(E=w.name,E&&!w.disabled&&(p.extraData=p.extraData||{},p.extraData[E]=w.value,w.type=="image"&&(p.extraData[E+".x"]=f.clk_x,p.extraData[E+".y"]=f.clk_y)));var N=1,C=2,k=e("meta[name=csrf-token]").attr("content"),L=e("meta[name=csrf-param]").attr("content");L&&k&&(p.extraData=p.extraData||{},p.extraData[L]=k),p.forceSync?o():setTimeout(o,10);var A,O,M=50,_,D=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&t.documentElement.nodeName!="parsererror"?t:null},P=e.parseJSON||function(e){return window.eval("("+e+")")},H=function(t,n,r){var i=t.getResponseHeader("content-type")||"",s=n==="xml"||!n&&i.indexOf("xml")>=0,o=s?t.responseXML:t.responseText;return s&&o.documentElement.nodeName==="parsererror"&&e.error&&e.error("parsererror"),r&&r.dataFilter&&(o=r.dataFilter(o,n)),typeof o=="string"&&(n==="json"||!n&&i.indexOf("json")>=0?o=P(o):(n==="script"||!n&&i.indexOf("javascript")>=0)&&e.globalEval(o)),o};return T}if(!this.length)return r("ajaxSubmit: skipping submit process - no element selected"),this;var a,f,l,c=this;typeof t=="function"?t={success:t}:t===undefined&&(t={}),a=t.type||this.attr2("method"),f=t.url||this.attr2("action"),l=typeof f=="string"?e.trim(f):"",l=l||window.location.href||"",l&&(l=(l.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:l,success:e.ajaxSettings.success,type:a||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var h={};this.trigger("form-pre-serialize",[this,t,h]);if(h.veto)return r("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return r("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var p=t.traditional;p===undefined&&(p=e.ajaxSettings.traditional);var d=[],v,m=this.formToArray(t.semantic,d);t.data&&(t.extraData=t.data,v=e.param(t.data,p));if(t.beforeSubmit&&t.beforeSubmit(m,this,t)===!1)return r("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[m,this,t,h]);if(h.veto)return r("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var g=e.param(m,p);v&&(g=g?g+"&"+v:v),t.type.toUpperCase()=="GET"?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+g,t.data=null):t.data=g;var y=[];t.resetForm&&y.push(function(){c.resetForm()}),t.clearForm&&y.push(function(){c.clearForm(t.includeHidden)});if(!t.dataType&&t.target){var b=t.success||function(){};y.push(function(n){var r=t.replaceTarget?"replaceWith":"html";e(t.target)[r](n).each(b,arguments)})}else t.success&&y.push(t.success);t.success=function(e,n,r){var i=t.context||this;for(var s=0,o=y.length;s<o;s++)y[s].apply(i,[e,n,r||c,c])};if(t.error){var w=t.error;t.error=function(e,n,r){var i=t.context||this;w.apply(i,[e,n,r,c])}}if(t.complete){var E=t.complete;t.complete=function(e,n){var r=t.context||this;E.apply(r,[e,n,c])}}var S=e("input[type=file]:enabled",this).filter(function(){return e(this).val()!==""}),x=S.length>0,T="multipart/form-data",N=c.attr("enctype")==T||c.attr("encoding")==T,C=i.fileapi&&i.formdata;r("fileAPI :"+C);var k=(x||N)&&!C,L;t.iframe!==!1&&(t.iframe||k)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){L=u(m)}):L=u(m):(x||N)&&C?L=o(m):L=e.ajax(t),c.removeData("jqxhr").data("jqxhr",L);for(var A=0;A<d.length;A++)d[A]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(i){i=i||{},i.delegation=i.delegation&&e.isFunction(e.fn.on);if(!i.delegation&&this.length===0){var s={s:this.selector,c:this.context};return!e.isReady&&s.s?(r("DOM not ready, queuing ajaxForm"),e(function(){e(s.s,s.c).ajaxForm(i)}),this):(r("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return i.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,n).on("submit.form-plugin",this.selector,i,t).on("click.form-plugin",this.selector,i,n),this):this.ajaxFormUnbind().bind("submit.form-plugin",i,t).bind("click.form-plugin",i,n)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,n){var r=[];if(this.length===0)return r;var s=this[0],o=this.attr("id"),u=t?s.getElementsByTagName("*"):s.elements,a;u&&!/MSIE [678]/.test(navigator.userAgent)&&(u=e(u).get()),o&&(a=e(':input[form="'+o+'"]').get(),a.length&&(u=(u||[]).concat(a)));if(!u||!u.length)return r;var f,l,c,h,p,d,v;for(f=0,d=u.length;f<d;f++){p=u[f],c=p.name;if(!c||p.disabled)continue;if(t&&s.clk&&p.type=="image"){s.clk==p&&(r.push({name:c,value:e(p).val(),type:p.type}),r.push({name:c+".x",value:s.clk_x},{name:c+".y",value:s.clk_y}));continue}h=e.fieldValue(p,!0);if(h&&h.constructor==Array){n&&n.push(p);for(l=0,v=h.length;l<v;l++)r.push({name:c,value:h[l]})}else if(i.fileapi&&p.type=="file"){n&&n.push(p);var m=p.files;if(m.length)for(l=0;l<m.length;l++)r.push({name:c,value:m[l],type:p.type});else r.push({name:c,value:"",type:p.type})}else h!==null&&typeof h!="undefined"&&(n&&n.push(p),r.push({name:c,value:h,type:p.type,required:p.required}))}if(!t&&s.clk){var g=e(s.clk),y=g[0];c=y.name,c&&!y.disabled&&y.type=="image"&&(r.push({name:c,value:g.val()}),r.push({name:c+".x",value:s.clk_x},{name:c+".y",value:s.clk_y}))}return r},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var n=[];return this.each(function(){var r=this.name;if(!r)return;var i=e.fieldValue(this,t);if(i&&i.constructor==Array)for(var s=0,o=i.length;s<o;s++)n.push({name:r,value:i[s]});else i!==null&&typeof i!="undefined"&&n.push({name:this.name,value:i})}),e.param(n)},e.fn.fieldValue=function(t){for(var n=[],r=0,i=this.length;r<i;r++){var s=this[r],o=e.fieldValue(s,t);if(o===null||typeof o=="undefined"||o.constructor==Array&&!o.length)continue;o.constructor==Array?e.merge(n,o):n.push(o)}return n},e.fieldValue=function(t,n){var r=t.name,i=t.type,s=t.tagName.toLowerCase();n===undefined&&(n=!0);if(n&&(!r||t.disabled||i=="reset"||i=="button"||(i=="checkbox"||i=="radio")&&!t.checked||(i=="submit"||i=="image")&&t.form&&t.form.clk!=t||s=="select"&&t.selectedIndex==-1))return null;if(s=="select"){var o=t.selectedIndex;if(o<0)return null;var u=[],a=t.options,f=i=="select-one",l=f?o+1:a.length;for(var c=f?o:0;c<l;c++){var h=a[c];if(h.selected){var p=h.value;p||(p=h.attributes&&h.attributes.value&&!h.attributes.value.specified?h.text:h.value);if(f)return p;u.push(p)}}return u}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var n=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var r=this.type,i=this.tagName.toLowerCase();n.test(r)||i=="textarea"?this.value="":r=="checkbox"||r=="radio"?this.checked=!1:i=="select"?this.selectedIndex=-1:r=="file"?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(t===!0&&/hidden/.test(r)||typeof t=="string"&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return e===undefined&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return t===undefined&&(t=!0),this.each(function(){var n=this.type;if(n=="checkbox"||n=="radio")this.checked=t;else if(this.tagName.toLowerCase()=="option"){var r=e(this).parent("select");t&&r[0]&&r[0].type=="select-one"&&r.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1});