(function(e,t,n){var r=top||t,i=t.document,s=t.navigator,o=t.location;e.extend({cookie:r.$.cookie});var u={init:function(n){var r=e(this),i=r.attr("id")||"tPager_"+e.now();r.attr("id",i),n.pager="#"+i;if(n.select!==!1){n.select=e.extend({option:[20,30,50,100],unit:"个"},n.select),n.select.option.sort(function(e,t){return e-t});var s=n.request.data,o=n.request.url,a=JSON.parse(e.cookie("pagenumCookie")||"{}"),f=+(a[o]||s.pagenum||s.pagesize),l=n.select.option;l.length>0&&e.inArray(f,l)==-1&&f<l[l.length-1]&&(f=+l[0],a[o]=f,e.cookie("pagenumCookie",JSON.stringify(a))),s.pagesize=f,s.pagenum=f}return r.data("option",n),u.getPage.call(this,n.request.data.pageidx,n),r.undelegate(),r.delegate("a",{"click.pagenav":function(n){n=n||t.event;var r=n.data.option,i=e(r.pager),s=e(this).attr("data-pageidx");u.getPage.call(i,s,r)}},{option:n}).delegate("input",{"keyup.pagenav":function(n){var n=n||t.event,r=n.which||n.keyCode;if(r==13){var i=n.data.option,s=e(i.pager),o=e(this).val();u.getPage.call(s,e.trim(o),i)}}},{option:n}).delegate("select",{"change.pagenav":function(n){var n=n||t.event,r=n.data.option,i=e(r.pager),s=+this.value,o=r.request.data,a=r.request.url,f=JSON.parse(e.cookie("pagenumCookie")||"{}");o.pagesize=s,o.pagenum=s,f[a]=s,e.cookie("pagenumCookie",JSON.stringify(f)),u.getPage.call(i,1,r)}},{option:n}),r=null,this},pageNum:function(){var t=e(this).data("option");return t?t.request.data.pageidx:!1},getPage:function(t,n){var r=e(this);n=n||r.data("option");var i=n.request.data,s=i.pageidx;switch(t){case"-1":case"+1":s+=+t;break;default:s=t}return s>0&&(!n.maxPage||s<=n.maxPage)&&(i.pageidx=+s,l.runFunction(n.onPaging,r),f.getData(n.request,function(e){var t=n.totalColumn||"total";n.total=e[t]||0;if(l.runFunction(n.loadData,r,[e,n.total])===!1)return!1;a.loadPageNav(n),l.runFunction(n.onSuccess,r,[e])})),this}},a={initPageNavHTML:function(t){var n=t.request.data,r=n.pagenum||n.pagesize,i=n.pageidx,s=t.total,o=t.select,u=Math.ceil(s/r),a=[];i==1?(a.push('<span data-pageidx="1">首页</span>'),a.push('<span data-pageidx="-1">上一页</span>')):(a.push('<a href="javascript:void(0);" data-pageidx="1">首页</a>'),a.push('<a href="javascript:void(0);" data-pageidx="-1">上一页</a>'));var f=i-Math.ceil(t.scope/2);f=f>-1?f:0;var l=f+Math.min(u,t.scope);for(;f<l&&f<u;f++){var c=f+1,h="";c===+i?h='<span data-pageidx="'+c+'" class="current">'+c+"</span>":h='<a href="javascript:void(0);" data-pageidx="'+c+'">'+c+"</a>",a.push(h)}i==u||u==0?(a.push('<span data-pageidx="1">下一页</span>'),a.push('<span data-pageidx="'+u+'">末页</span>')):(a.push('<a href="javascript:void(0);" data-pageidx="+1">下一页</a>'),a.push('<a href="javascript:void(0);" data-pageidx="'+u+'">末页</a>')),u!=0&&a.push('<input type="text" />&nbsp;&nbsp;/&nbsp;<em class="maxPage">'+u+"</em>&nbsp;页");if(e.isPlainObject(o)&&o.option&&o.option.length>0){var p=o.option||[],d=0,v=p.length,m=null;if(v>0){a.push("<select>");for(;d<v;d++)m=p[d],a.push("<option"+(m==r?' selected="selected"':"")+' value="'+p[d]+'">'+p[d]+"&nbsp;"+(o.unit||"个")+"&nbsp;/&nbsp;页</option>");a.push("</select>")}}return t.maxPage=u,'<div class="tpage-nav">'+a.join("")+"</div>"},loadPageNav:function(t){var n=e(t.pager);return $pageNav=e(this.initPageNavHTML(t)),n.data("tPager",t),n.html($pageNav),this}},f={getData:function(t,r){var i=this;l.runFunction(t.beforeSend),t.url||e.error("请求地址不存在！");var s=t.url.split("_")[0].toUpperCase();l.inArray(s,["GET","POST"])==-1&&(s=null),t.type=t.type?t.type.toUpperCase():s?s:"GET",t.type=t.type?t.type.toUpperCase():"GET",t.data=t.data||{},t.rmunderline=t.rmunderline!==n?t.rmunderline:!0,t.data.accesstoken||(t.data.accesstoken=u.data("token")),t.stringify=t.stringify!==n?t.stringify:!0;var o=e.extend({},t,{success:function(e){l.runFunction(r,t,[e]),t.jQ&&t.jQ.length>0?l.runFunction(t.success,t.jQ[0],[e]):l.runFunction(t.success,[e])},timeout:t.timeout||2e4,data:t.type=="POST"&&t.stringify?JSON.stringify(t.data):t.data,url:t.url,error:l.isFunction(t.error)?t.error:function(){},complete:l.isFunction(t.complete)?t.complete:function(){}});e.ajax(o)},setData:function(t,r){var i=this;l.runFunction(t.beforeSend),t.url||e.error("请求地址不存在！"),t.data=t.data||{},t.rmunderline=t.rmunderline!==n?t.rmunderline:!0;var s=t.url.split("_")[0].toUpperCase();l.inArray(s,["GET","POST"])==-1&&(s=null),t.type=t.type?t.type.toUpperCase():s?s:"GET",t.stringify=t.stringify!==n?t.stringify:!0,t.data.accesstoken||(t.data.accesstoken=u.data("token"));var o=e.extend({},t,{success:function(e){l.runFunction(r,t,[e]),l.runFunction(t.success,[e])},timeout:t.timeout||2e4,data:t.type=="POST"&&t.stringify?JSON.stringify(t.data):t.data,url:t.url,error:l.isFunction(t.error)?t.error:function(){}}),a=t.data;for(var f in a)a.hasOwnProperty(f)&&typeof a[f]=="string"&&(a[f]=l.nbsp2space(a[f]));e.ajax(o)}},l={typeOf:function(e){var t=Object.prototype.toString.call(e);return/\[object\s+(.*)\]/ig.exec(t)[1].toLowerCase()},inArray:function(t,n){if(e.inArray)return e.inArray(t,n);for(var r=n.length-1;r>-1;r--)if(n[r]==t)return r;return-1},isFunction:function(t){return e.isFunction(t)},runFunction:function(e,n,r){if(this.isFunction(e)){var i=arguments,s=i.length;if(s==1)return e.apply(t);if(s==2)return this.typeOf(n)=="array"?e.apply(t,n):e.apply(n);if(s==3)return e.apply(n||t,r)}},json2StringWAU:function(e){return e?JSON.stringify(e).replace(/"(\w*?)":/ig,function(e,t){return'"'+t.replace(/_/g,"")+'":'}):e},json2StringWU:function(e){return e?JSON.stringify(e).replace(/"([A-Za-z0-9]*)_([A-Za-z0-9]*)":/ig,'"$1$2":'):e},rmUnderline:function(t){return t?e.parseJSON(l.json2StringWAU(t)):t}};e.fn.tPager=function(t){if(u[t])return u[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return u.init.call(this,t);e.error("不存在"+t+"方法！")}})(jQuery,window,undefined);